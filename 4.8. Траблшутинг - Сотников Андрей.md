# Домашнее задание к занятию "4.8. Траблшутинг"

---

### Задание 1. 

> 1. Укажите путь к файлам логов веб-сервера `Nginx`. 
  
`access_log /var/log/nginx/access.log`  
`error_log /var/log/nginx/error.log`

> 2. Где находится конфигурационный файл, в котором можно посмотреть / поменять эти пути?  
  
Документация говорит, что файл nginx.conf может быть в:  
- `/usr/local/nginx/conf`
- `/etc/nginx`
- `/usr/local/etc/nginx`  

У меня при установке файл лежал в `/etc/nginx`

> 3. Какой командой можно воспользоваться для просмотра файла журнала в режиме реального времени?
> Попробуйте найти сами, либо воспользуйтесь [ссылкой](https://andreyex.ru/operacionnaya-sistema-linux/nastrojka-zhurnala-oshibok-i-dostupa-nginx/).

`tail -f  *.log`

---

### Задание 2. 

Познакомьтесь со схемой сети.

![](https://i.imgur.com/RefFHYj.png)

> 1. `COMP1` не может обменяться данными с `COMP4`. Какую последовательность действий вы выберете для того, чтобы локализовать проблему?

Первым делом пропинговать один хост со второго. 
- Если не прошел, я бы попробовал пропинговать другой хост в том же широковещательном домене (например, `COMP5` с `COMP1`), что дало бы понимание, в каком сегменте копать дальше. Если пинг проходит - проблема наверняка где-то между последним маршрутизатором и хостом, а если не проходит - в промежуточных узлах или на стороне хоста, с которого отправляется пинг. Но лучше будет воспользоваться чем-то вроде `traceroute` и посмотреть, после какого узла пакеты не передаются. После этого проверить последнее ответившее устройство и следующее за ним. Проверить сначала, по возможности, физически (подключение, линки), потом на канальном уровне (интерфейсы и их настройки, не забанен ли MAC, проходит ли arpping), затем настройки firewall, forwarding, портов.
- Если пинг прошел, то проблемы скорее всего на L4 и выше, об этом, вроде бы, следующий пункт.

> 2. Возможно ли, чтобы при выполнении `ping 192.168.1.2` с компьютера `COMP5`, `ping` прошёл, а подключение по HTTP с `COMP5` на `COMP1` не проходило бы? Поясните свой  ответ максимально детально.  

Возможно, причины могут быть различными:
- Некорректные настройки Firewall или NAT (например, фильтруется или не проброшен соответстующий порт);
- Порт не фильтруется, но его никто не слушает (например, если веб-сервер упал);
- Где-то в промежуточных узлах трафик по порту переадресовывается куда-то не туда.

> 3. `COMP5` отправляет `ping` на `COMP1` и `COMP2`, при этом `COMP1` на `ping` отвечает, а `COMP2` - нет. Приведите максимальное количество причин. Самую простую, но нередко встречающуюся - «У `COMP2` выдернули кабель питания» - я уже ответил за вас.

- У `COMP2` выдернули патч-корд) (или отключен WiFi);
- Некорректно настроен сетевой интерфейс на `COMP2` или коммутаторе перед ним;
- MAC-адрес `COMP2` заблокирован на стороне маршрутизатора `10.1.1.1` в его подсети (или наоборот, MAC роутера заблокирован у `COMP2`);
- Firewall на `COMP2` фильтрует ICMP-трафик;
- На стороне `COMP2` фильтруется трафик с IP адреса `10.1.1.2`.

> 4. `COMP1` пингует только адреса из подсети `192.168.1.0/24` (`COMP2` и `192.168.1.1`), больше никакие адреса не пингуются. С чем это может быть связано?  

- На маршрутизаторе `192.168.1.1` в настройках соответствующего интерфейса некорректная маска подсети, и маршрутизатор считает, что адреса `192.168.2.*` находятся в той же подсети, что и `COMP1`, и отбрасывает пакеты;
- Некорректно настроена маршрутизация или нет соединения между роутерами;
- Firewall на маршрутизаторе не пропускает ICMP;
- На маршрутизаторе`'10.1.1.2` заблокирован IP `10.1.1.1`;
- Все устройства во второй подсети выключены.


---

### Задание 3*. 

Используя схему из Задания 2, попробуйте ответить на вопросы:
> 1. `COMP1` и `COMP2` оба пингуют `10.1.1.2`, однако не пингуют `192.168.2.1` и прочие адреса из `192.168.2.0/24`. Как вы думаете, что не так и как это можно исправить?  

Скорее всего роутер `10.1.1.1` не знает, куда ему отправлять пакеты с DST IP из подсети `192.168.2.0`, потому что в его таблице маршрутизации этой подсети нет. Если статически добавить в таблицу маршрутизации, что в эту подсеть можно попасть через `10.1.1.2`, то все должно заработать.

> 2. Какими способами мы можем сделать так, чтобы `COMP2` не смог общаться ни с кем кроме своей локальной сети? (Приведите вариант с настройками самого `COMP2` и попробуйте придумать, можно ли что-то сделать на маршрутизаторе `192.168.1.1`)  

Думаю, если на `COMP2` установить шлюзом по умолчанию свой же IP, все пакеты, адресаты которых вне локальной сети, будут отбрасываться. У некоторых роутеров можно ограничить доступ определнного хоста "во вне" через веб-интерфейс, вручную же можно прописать правило в `iptables`, запрещающее forwarding с `IP COMP2` в другие интерфейсы.

> 3. Как вы думаете, что будет происходить при попытке провести `ping` с `COMP5` на `192.168.2.3` ?  

`COMP5` проверит в своей ARP-таблице, есть ли там MAC-адрес, соответствующий `192.168.2.3`, если есть - сформирует кадр, отправит его на коммутатор, тот проверит, на каком порту у него DST MAC и отправит фрейм в нужный порт. Если MAC адреса в ARP-таблице нет, `COMP5` сделает ARP-запрос, который коммутатор разошлет всем участникам сети, кроме источника, `COMP4` ответным фреймом даст понять, что ищут именно его. Заодно при ответе коммутатор добавит соответствие порта и MAC-адреса в свою таблицу коммутации.


---

### Задание 4*. 

> - Сделайте `ping` с одной виртуальной / физической машины на другую.

![image](https://user-images.githubusercontent.com/115862529/196913490-63324503-c3a4-415e-a023-5dcc8f0c123e.png)

> - Используя [описание утилиты iperf](https://losst.ru/kak-polzovatsya-iperf), загрузите канал между двумя виртуальными машинами на максимум, например, на 60 секунд, в процессе загрузки повторите `ping`.

![image](https://user-images.githubusercontent.com/115862529/196913585-f82bc2d7-177f-44a4-9e4f-774ffc6f8253.png)​
98
*Приведите скриншоты/ответы команд до и во время высокой загрузки каналов.*
99


> - Изменились ли цифры в ответе команды `ping`? Почему? Есть ли разница между физическими и виртуальными машинами?

Среднее время ответа выросло в 1,5 раза, максимальное - почти в 3. Думаю, из-за высокой нагруженности канала ICMP-пакеты могут дольше находиться в очереди на передачу, подозреваю, что это не в последнюю очередь зависит от производительности сетевого оборудования.
Разница между физическими и вирт. машинами думаю есть, но затрудняюсь ответить, в чью она пользу -- с одной стороны, между двумя вирт.машинами на одной физической пакетам не нужно бежать по проводам или по радиоволнам, что должно снизить задержки, но, с другой стороны, физическое сетевое оборудование должно быть точно производительнее виртуального, и если уменьшить число хопов до одного (связать два хоста одним патч-кордом, например), то по идее влияние загруженности канала на пинг в таком варианте будет меньше, чем в варианте с двумя виртуалками. Но, конечно, я могу и заблуждаться. 
